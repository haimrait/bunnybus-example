'use strict';

const DefaultOptions = require('./defaultOptions.js');
const { ClientFactory, HealthReporter, ShutdownOrchestrator, VersionReporter } = require('./components');

class Plugin {
    constructor(server, overrideOptions = {}) {
        this.options = Object.assign(DefaultOptions, overrideOptions);

        const clientFactory = new ClientFactory({ server, options: this.options });
        const healthReporter = new HealthReporter({ server, options: this.options });
        const shutdownOrchestrator = new ShutdownOrchestrator({ server, process, options: this.options });
        const versionReporter = new VersionReporter({ server, options: this.options });

        clientFactory.configure();
        healthReporter.configure();
        shutdownOrchestrator.configure();
        versionReporter.configure();

        return this;
    }
}

module.exports = Plugin;
