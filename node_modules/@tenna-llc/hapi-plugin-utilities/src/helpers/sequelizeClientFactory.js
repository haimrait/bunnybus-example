'use strict';

const Joi = require('@hapi/joi');
const BaseClientFactory = require('./baseClientFactory');

const schema = {
    add: Joi.object({
        name: Joi.string().required(),
        config: Joi.object({
            dialect: Joi.string().required()
        })
            .unknown(true)
            .required()
    }).required()
};

class SequelizeClientFactory extends BaseClientFactory {
    constructor() {
        super();
    }

    add(clientConfiguration) {
        const { error, value: validatedClientConfiguration } = schema.add.validate(clientConfiguration);

        if (error) {
            throw error;
        }

        super.add(validatedClientConfiguration);
    }

    build(name) {
        const { Sequelize } = require('sequelize');

        return new Sequelize(super.get(name));
    }
}

module.exports = SequelizeClientFactory;
