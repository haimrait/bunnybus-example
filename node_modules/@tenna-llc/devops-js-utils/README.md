# DevOps JS Utilities
This is a collection of developer operation centric utilities to help with various ops tasks

![Test](https://github.com/tenna-llc/devops-js-utils/workflows/Test/badge.svg)


<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->


- [Example of installing project](#example-of-installing-project)
- [Intent](#intent)
- [Tools](#tools)
  - [`json-wrap`](#json-wrap)
  - [`pt-json-cleaner`](#pt-json-cleaner)
  - [`aws-routetable-snapshot`](#aws-routetable-snapshot)

<!-- END doctoc generated TOC please keep comment here to allow auto update -->

## Example of installing project
```bash
npm login --registry=https://npm.pkg.github.com
Username: <your github username>
Password: <your github api token>
Email: (this IS public) <your email>
Logged in as <your github username> on https://npm.pkg.github.com/.

npm i -g @tenna-llc/devops-js-utils --registry=https://npm.pkg.github.com/tenna-llc
```

## Intent
The intent of this project is to allow us a space to build small components and CLIs that we can chain together to do big things.

## Tools

### `json-wrap`
[Code](src/commands/json-wrap.js)

A transform tool to wrap a regular string in JSON.

Example
```
node src/server.js | json-wrap | pino-papertrail
```

### `pt-json-cleaner`
[Code](src/commands/papertrail-json-cleaner.js)

This is a dedicated log cleaning tool targetted for Papertrail JSON output.  Parsed through the JSON to extract the hidden JSON content under the message property.

Example
```
papertrail -j -s too-ti-ctc-prd --min-time 6/5/2020  received event for 1761100444 | pt-json-cleaner > somefile.json
```

### `aws-routetable-snapshot`
[Code](src/commands/aws-routetable-snapshot.js)

Uses the `aws-sdk` to print all route tables for any number of VPCs.

Example
```
aws-routetable-snapshot -v vpc-0b8220290b22a68c2
===============================vpc-0b8220290b22a68c2===============================
{
  "RouteTables": [
    {
      "Associations": [
        {
          "Main": true,
          "RouteTableAssociationId": "rtbassoc-0a3885e9a6da4f28b",
          "RouteTableId": "rtb-09de79912700eb098",
          "AssociationState": {
            "State": "associated"
          }
        },
        {
          "Main": false,
          "RouteTableAssociationId": "rtbassoc-05ebd08b5097ba90b",
          "RouteTableId": "rtb-09de79912700eb098",
          "SubnetId": "subnet-01e1af0285ba34d93",
          "AssociationState": {
            "State": "associated"
          }
        }
      ],
      "PropagatingVgws": [],
      "RouteTableId": "rtb-09de79912700eb098",
      "Routes": [
        {
          "DestinationCidrBlock": "10.131.0.0/19",
          "GatewayId": "local",
          "Origin": "CreateRouteTable",
          "State": "active"
        },
        {
          "DestinationCidrBlock": "0.0.0.0/0",
          "GatewayId": "igw-047086e6f84d6d693",
          "Origin": "CreateRoute",
          "State": "active"
        },
        {
          "DestinationPrefixListId": "pl-63a5400a",
          "GatewayId": "vpce-021e2697df9144c0d",
          "Origin": "CreateRoute",
          "State": "active"
        }
      ],
      "Tags": [
        {
          "Key": "Name",
          "Value": "S1-STG-DMZ"
        }
      ],
      "VpcId": "vpc-0b8220290b22a68c2",
      "OwnerId": "766472192835"
    }
  ]
}
===================================================================================
```

#### Options

`-v, --vpcids` : any number of vpc ids that are space delimited

