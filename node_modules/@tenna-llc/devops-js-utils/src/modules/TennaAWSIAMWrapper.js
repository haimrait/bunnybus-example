#!/usr/bin/env node
'use strict';

class TennaAWSIAMWrapper {
    constructor({ IAM } = {}) {
        this.IAM = IAM;
    }

    async getUserMFAStatus({ user }) {
        const { MFADevices } = await this.IAM.listMFADevices({ UserName: user.UserName }).promise();
        return MFADevices.some(({ EnableDate }) => Boolean(EnableDate));
    }

    async getFullUserList() {
        let done = false;
        let page = undefined;
        let users = [];
        while (!done) {
            const { Users, IsTruncated, Marker } = await this.IAM.listUsers({ Marker: page }).promise();
            page = Marker;
            done = !IsTruncated;
            users = users.concat(Users);
        }

        return users;
    }
}

module.exports = TennaAWSIAMWrapper;
