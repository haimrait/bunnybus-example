#!/usr/bin/env node
'use strict';

const {
    NewLineTransform,
    Json: { SelectPropertyTransform, StringToJsonBufferTransform },
    String: { ReplaceStringTransform, ThrowUntilCharTransform }
} = require('../streams');

process.stdin
    .pipe(new StringToJsonBufferTransform())
    .pipe(new SelectPropertyTransform({ scope: '.message' }))
    .pipe(new ThrowUntilCharTransform({ char: '{' }))
    .pipe(new ReplaceStringTransform({ searchPattern: /\\"/g, newSubstring: '"' }))
    .pipe(new StringToJsonBufferTransform())
    .pipe(new NewLineTransform())
    .pipe(process.stdout);
